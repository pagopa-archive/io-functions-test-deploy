# manual execution
trigger: none
pr: none

pool:
  vmImage: 'windows-2019'

stages:
  # A) pack healthcheck
  - stage: healthcheck
    dependsOn: []
    jobs:
      # A1) 
      - job: healthcheck      
        steps:
        - template: azure-templates/healthcheck.yaml
          parameters:
            azureSubscription: '$(PRODUCTION_AZURE_SUBSCRIPTION)'
            appName: '$(PRODUCTION_APP_NAME)'
            #endpoint: 'https://$(PRODUCTION_APP_NAME)-staging.azurewebsites.net/healthcheck/ok'
            endpoint: 'https://httpbin.org/anything'
            endpointType: 'public'
            headers: 'KEY1=$(SECRET1) KEY2=$(SECRET2)'
            containerInstanceResourceGroup: 'io-d-rg-tdeploy'
            containerInstanceVNet: 'io-d-vnet-tdeploy'
            containerInstanceSubnet: 'azure-devops'
