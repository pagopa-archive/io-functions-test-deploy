# Azure DevOps pipeline to do periodic checks
#

# A pipeline with no CI trigger, just schedules
trigger: none
pr: none

schedules:
  - cron: "0/5 * * * *"
    displayName: Daily midnight build
    branches:
      include:
      - master
      - test_cron_pipeline
    always: true # Run always irrespective of changes


# Execute agents (jobs) on latest Ubuntu version.
# To change OS for a specific, ovverride "pool" attribute inside the job definition
pool:
  vmImage: 'ubuntu-latest'

variables:
  NODE_VERSION: '10.14.1'
  
parameters:
  # the branch, tag or commit to deploy
  - name: 'gitReference'
    type: string
    default: '$(Build.SourceVersion)'


jobs:
  - job: first_check
    steps:
      - script: |
          git fetch && git checkout ${{ parameters.gitReference }}
        displayName: 'Checkout reference'  
      
      - script:
          ./scripts/pagopa_api_check.sh
        displayName: 'Check pagoPA api'
